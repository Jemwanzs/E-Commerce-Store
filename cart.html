<!-- Cart Page -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart - StoreJMS</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="icon" href="images/favicon.png" type="image/png">
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body>
    <!-- Header and Navigation as before -->
    <div class="header">
        <div class="container">
            <div class="navbar">
                <div class="logo">
                    <a href="index.html"><img src="images/logo2.png" width="150px" alt="Logo"></a>
                </div>
                <nav>
                    <ul id="menuItems">
                        <!--add clickable menu using tag <a></a> to link pages-->
                        <li><a href="products.html">Products</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="account.html">Account</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="community.html">Join Community</a></li>
                        <li><a href="index.html">Home</a></li>
                    </ul>
                </nav>
                <img src="images/shopping-bag1.png" width="30px" height="30px">
                <img src="images/menu.png" class="menu-icon" onclick="menutoggle()">
            </div>
        </div>
    </div>


    <div class="container cart-page">
        <table id="cartTable">
            <tr>
                <th>Item</th>
                <th>Action</th>
                <th>Color</th>
                <th>Qty</th>
                <th>Subtotal</th>
            </tr>
            <!-- Cart items will be inserted here -->

            <div class="total-cost">
                <table>
                    <tr>
                        <td>Subtotal</td>
                        <td id="subtotal">$ 0.00</td>
                    </tr>
                    <tr>
                        <td>VAT Tax</td>
                        <td id="vat">$ 0.00</td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        <td id="total">$ 0.00</td>
                    </tr>
                </table>
            </div>

        </table>
        <div class="small-container">
            <button onclick="printCart()" class="CartPrintBtn">Print Cart</button>
            <button onclick="sendEmail()" class="CartEmailBtn">Send to Email</button>
        </div>
    </div>


    <script>
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartTable = document.getElementById('cartTable').getElementsByTagName('tbody')[0];
            let subtotal = 0;

            cart.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td>
                            <div class="cart-info">
                                <img src="${item.image || 'images/default.jpg'}" alt="Product Image" style="width: 50px;">
                                <div>
                                    <p>${item.name}</p>
                                    <small>$ ${item.price}</small>
                                </div>
                            </div>
                        </td>
                        <td><a href="#" onclick="removeItem('${item.name}')">Remove</a></td>
                        <td>${item.color}</td>
                        <td>${item.quantity}</td>
                        <td>$ ${(item.price * item.quantity).toFixed(2)}</td>

                    `;
                cartTable.appendChild(row);
                subtotal += item.price * item.quantity;
            });

            const vat = subtotal * 0.16; // 16% VAT
            const total = subtotal + vat;

            document.getElementById('subtotal').textContent = `$ ${subtotal.toFixed(2)}`;
            document.getElementById('vat').textContent = `$ ${vat.toFixed(2)}`;
            document.getElementById('total').textContent = `$ ${total.toFixed(2)}`;
        }

        function removeItem(name) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.name !== name);
            localStorage.setItem('cart', JSON.stringify(cart));
            window.location.reload();
        }

        function printCart() {
            window.print();
        }

        function sendEmail() {
            emailjs.init("dKjIUTAd9JasJPqGX"); // Replace with your EmailJS user ID

            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            let cartDetails = 'Cart Details:\n\n';

            cart.forEach(item => {
                cartDetails += `Name: ${item.name}\nPrice: $${item.price}\nQuantity: ${item.quantity}\nColor: ${item.color}\n\n`;
            });

            const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace('$ ', ''));
            const vat = parseFloat(document.getElementById('vat').textContent.replace('$ ', ''));
            const total = parseFloat(document.getElementById('total').textContent.replace('$ ', ''));

            cartDetails += `Subtotal: $${subtotal.toFixed(2)}\nVAT: $${vat.toFixed(2)}\nTotal: $${total.toFixed(2)}`;

            emailjs.send("service_ra9936u", "template_yhulkir", {
                from_name: 'Your Store',
                to_name: 'Customer',
                subject: 'Cart Details',
                message: cartDetails
            }).then(function (response) {
                alert('Email sent successfully!');
            }, function (error) {
                alert('Failed to send email. Please contact us.');
            });
        }

        loadCart();
    </script>


    <!--
    <script>
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartTable = document.getElementById('cartTable');
            let subtotal = 0;

            cart.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="cart-info">
                            <img src="images/default.jpg" alt="Product Image">
                            <div>
                                <p>${item.name}</p>
                                <small>$ ${item.price}</small>
                            </div>
                        </div>
                    </td>
                    <td>${item.quantity}</td>
                    <td>$ ${item.price * item.quantity}</td>
                    <td>${item.color}</td>
                    <td><a href="#" onclick="removeItem('${item.name}')">Remove</a></td>
                `;
                cartTable.appendChild(row);
                subtotal += item.price * item.quantity;
            });

            const vat = subtotal * 0.16; // 16% VAT
            const total = subtotal + vat;

            document.getElementById('subtotal').textContent = `$ ${subtotal.toFixed(2)}`;
            document.getElementById('vat').textContent = `$ ${vat.toFixed(2)}`;
            document.getElementById('total').textContent = `$ ${total.toFixed(2)}`;
        }

        function removeItem(name) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.name !== name);
            localStorage.setItem('cart', JSON.stringify(cart));
            window.location.reload();
        }

        function printCart() {
            window.print();
        }

        function sendEmail() {
            // Implement email sending logic
            alert('Email sending feature is not implemented.');
        }

        loadCart();
    </script>-->

    <!-------JS FOR SEND EMAIL -->

    <script>
        emailjs.init("dKjIUTAd9JasJPqGX"); // Replace with your EmailJS user ID

        function sendEmail() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            let cartDetails = 'Cart Details:\n\n';

            cart.forEach(item => {
                cartDetails += `Name: ${item.name}\nPrice: $${item.price}\nQuantity: ${item.quantity}\nColor: ${item.color}\n\n`;
            });

            const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace('$ ', ''));
            const vat = parseFloat(document.getElementById('vat').textContent.replace('$ ', ''));
            const total = parseFloat(document.getElementById('total').textContent.replace('$ ', ''));

            cartDetails += `Subtotal: $${subtotal.toFixed(2)}\nVAT: $${vat.toFixed(2)}\nTotal: $${total.toFixed(2)}`;

            emailjs.send("service_ra9936u", "template_yhulkir", {
                from_name: 'Your Store',
                to_name: 'Customer',
                subject: 'Cart Details',
                message: cartDetails
            }).then(function (response) {
                alert('Email sent successfully!');
            }, function (error) {
                alert('Failed to send email. Print and send email to jamosammy@gmail.com or ; contact us');
            });
        }
    </script>

    <!------->

</body>

</html>